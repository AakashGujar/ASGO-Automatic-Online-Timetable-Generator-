<?php
//session start 
@ob_start();
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

//connection to database
include('user_connection.php');

//storing data into global variable
  $institute_start_hour			= 7.00;
  $institute_start_minute		= 0.00;
  $institute_start_amorpm		= "am";
  $institute_end_hour			= 12.00;
  $institute_end_minute			= 0.30;
  $institute_end_amorpm			= "pm";
  $institute_lecture_time_gap	= 0.30;
  $recess_count					= 1;
  $first_recess_start_hour		= 9.00;
  $first_recess_start_minute	= 0.30;
  $first_recess_start_amorpm	= "pm";
  $first_recess_end_hour		= 10.00;
  $first_recess_end_minute		= 0.00;
  $first_recess_end_amorpm		= "pm";
  $first_recess_time_gap		= 0.30;
  $second_recess_start_hour		= 1.00;
  $second_recess_start_minute	= 0.00;
  $second_recess_start_amorpm	= "pm";
  $second_recess_end_hour		= 1;
  $second_recess_end_minute		= 0.0;
  $second_recess_end_amorpm		= "pm";
  $second_recess_time_gap		= 0.30;
  $daily_lecture_count			= 6;
  $holiday						= 1;
  $closed_day					= 3;
  $halfday						= 1;
  $opened_day					= 5;
  $halfday_lecture_count		= 3;
  $srno=1;

 //calculating total number of lecture
$five_days_lecture_count=$daily_lecture_count *5;
$six_days_lecture_count=$daily_lecture_count *6;
$fiveday_plus_halfday_lecture_count=$five_days_lecture_count + $halfday_lecture_count ;
$total_day_count=6;
 //allocating total number of lecture
 if(($holiday == 1)&($halfday == 1)){
	$total_lecture_count=$five_days_lecture_count;
	$total_day_count=5;
 }
 else if(($holiday == 0)&($halfday == 1)){
	$total_lecture_count=$fiveday_plus_halfday_lecture_count;
 }
 else if(($holiday == 0)&($halfday == 0)){
	$total_lecture_count=$six_days_lecture_count;
 }
 
//timmming setting
//min+hour
$institute_start_time=$institute_start_hour+$institute_start_minute;
$institute_end_time=$institute_end_hour+$institute_end_minute;
$first_recess_start_time=$first_recess_start_hour+$first_recess_start_minute;
$first_recess_end_time=$first_recess_end_hour+$first_recess_end_minute;

//before recess
	$minute=$institute_start_minute;
	for($i=$institute_start_time;$i <= $first_recess_start_time;)
	{
		$institute_time_recored[]=number_format((float)$i, 2);
		
		$minute=$minute+$institute_lecture_time_gap;
		
		if($minute >= "0.60" )
		{
			$minus="0.60";
			$minute=$minute - $minus;
			$i=floor($i)+1.0;
			
		}
		$i=floor($i)+$minute;  
	}
	
if($recess_count == 1)
{
	//after recess
	$minute=$first_recess_end_minute;
	for($i=$first_recess_end_time;$i <= $institute_end_time;)
	{
		$institute_time_recored[]=number_format((float)$i, 2);
		
		$minute=$minute+$institute_lecture_time_gap;
		if($minute >= "0.60" )
		{
			$minus="0.60";
			$minute=$minute - $minus;
			$i=floor($i)+1.0;
			
		}
		$i=floor($i)+$minute;  
	}
}
else
{
	//min+hour
	$second_recess_start_time=$second_recess_start_hour+$second_recess_start_minute;
	$second_recess_end_time=$second_recess_end_hour+$second_recess_end_minute;

	//after recess and before 2 recess
	$minute=$first_recess_end_minute;
	for($i=$first_recess_end_time;$i <= $second_recess_start_time;)
	{
		$institute_time_recored[]=number_format((float)$i, 2);
		
		$minute=$minute+$institute_lecture_time_gap;
		if($minute >= "0.60" )
		{
			$minus="0.60";
			$minute=$minute - $minus;
			$i=floor($i)+1.0;
			
		}
		$i=floor($i)+$minute;  
	}
	
	//after 2 recess 
	$minute=$second_recess_end_minute;
	for($i=$second_recess_end_time;$i <= $institute_end_time;)
	{
		$institute_time_recored[]=number_format((float)$i, 2);
		
		$minute=$minute+$institute_lecture_time_gap;
		if($minute >= "0.60" )
		{
			$minus="0.60";
			$minute=$minute - $minus;
			$i=floor($i)+1.0;
			
		}
		$i=floor($i)+$minute;  
	}
}
$total_lecture_array_count=count($institute_time_recored);
$day_wise_recess_id=0;
for($j=0;$j<6;$j++)
{
	if($j != $closed_day){
	$day_wise_id=0;
for($i=0;$i<$total_lecture_array_count-1;$i++)
{
	$day_wise_id=$day_wise_id+1;
	
	$institute_time_recored[$i]." - ".$institute_time_recored[$i+1];
	if($institute_time_recored[$i] == $first_recess_start_time)
	{
		$day_wise_recess_id=$day_wise_recess_id+1;
		$sql4 = "INSERT INTO custom_timetable (col_timming,col_day,col_day_wise_id,col_available) VALUES ('".$institute_time_recored[$i]." - ".$institute_time_recored[$i+1]."','".$j."','".$day_wise_recess_id."','0')";
		$result4 = $conn->query($sql4);
		$day_wise_id_before=$day_wise_id;
		$day_wise_id=0;
	}else{
		$sql4 = "INSERT INTO custom_timetable (col_timming,col_day,col_day_wise_id,col_available) VALUES ('".$institute_time_recored[$i]." - ".$institute_time_recored[$i+1]."','".$j."','".$day_wise_id."','1')";
		$result4 = $conn->query($sql4);
		$day_wise_id_after=$day_wise_id;
	}
}
}
}

/* create user institute_time_detail table  */
  $sql_query1="CREATE TABLE IF NOT EXISTS custom_timetable
   ( /* Column name      			 		Column data type */
		srno       	 						int AUTO_INCREMENT,
		col_timming							text,
		col_day								int, 
		col_day_wise_id     				int,
		col_available      					int,
		col_teacher_name    				text,
		col_lecture_name    				text,
		col_lecture_type    				text,
		col_lecture_place					text,
		col_batch         					text,
		col_batch_day       				int,
		col_batch_student   				text,
		col_class_name      				text,
		col_row_span       	                int,
		PRIMARY KEY (`srno`)
	);";
  $conn->query($sql_query1);/* execution of query */
	/*
/* create user institute_time_detail table  */
  $sql_query1="CREATE TABLE IF NOT EXISTS free_solt_detail
   ( /* Column name      			 		Column data type */
		srno       	 						int AUTO_INCREMENT,
		col_teacher_name    				text,
		col_first_lecture_count_0       	int,
		col_first_lecture_count_1       	int,
		col_first_lecture_count_2       	int,
		col_first_lecture_count_3       	int,
		col_first_lecture_count_4       	int,
		col_first_lecture_count_5       	int,
		col_recess_before_lecture_count_0   int,
		col_recess_before_lecture_count_1   int,
		col_recess_before_lecture_count_2   int,
		col_recess_before_lecture_count_3   int,
		col_recess_before_lecture_count_4   int,
		col_recess_before_lecture_count_5   int,
		col_recess_after_lecture_count_0    int,
		col_recess_after_lecture_count_1    int,
		col_recess_after_lecture_count_2    int,
		col_recess_after_lecture_count_3    int,
		col_recess_after_lecture_count_4    int,
		col_recess_after_lecture_count_5	int,
		PRIMARY KEY (`srno`)
	);";
  $conn->query($sql_query1);/* execution of query */
  
  $sql4 = "
  INSERT INTO free_solt_detail
  (
  col_teacher_name,
  col_first_lecture_count_0,
  col_first_lecture_count_1,
  col_first_lecture_count_2,
  col_first_lecture_count_3,
  col_first_lecture_count_4,
  col_first_lecture_count_5,
  col_recess_before_lecture_count_0,
  col_recess_before_lecture_count_1,
  col_recess_before_lecture_count_2,
  col_recess_before_lecture_count_3,
  col_recess_before_lecture_count_4,
  col_recess_before_lecture_count_5,
  col_recess_after_lecture_count_0,
  col_recess_after_lecture_count_1,
  col_recess_after_lecture_count_2,
  col_recess_after_lecture_count_3,
  col_recess_after_lecture_count_4,
  col_recess_after_lecture_count_5
  ) 
  VALUES 
  (
  'het_sheth',
  '2',
  '2',
  '2',
  '2',
  '2',
  '2',
  '".$day_wise_id_before."',
  '".$day_wise_id_before."',
  '".$day_wise_id_before."',
  '".$day_wise_id_before."',
  '".$day_wise_id_before."',
  '".$day_wise_id_before."',
  '".$day_wise_id_after."',
  '".$day_wise_id_after."',
  '".$day_wise_id_after."',
  '".$day_wise_id_after."',
  '".$day_wise_id_after."',
  '".$day_wise_id_after."')";
	$result4 = $conn->query($sql4);
  
	/*
$fullpath = 'jklm/file.ext/hhshsh';
$folder = substr($fullpath, 0, strpos($fullpath, '/'));
echo $folder;
// Output => folderName*/
?>