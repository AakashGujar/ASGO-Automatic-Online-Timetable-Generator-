<?php
//session start 
@ob_start();
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

//connection to database
include('user_connection.php');

//inilized variable
$student_count    = "";
$batch_count      = "";
$lecture_gap_time = "";

//storing data into global variable
  $institute_start_hour			= htmlspecialchars($_POST['post_institute_strat_hour']);
  $institute_start_minute		= htmlspecialchars($_POST['post_institute_strat_minute']);
  $institute_start_amorpm		= htmlspecialchars($_POST['post_institute_start_amorpm']);
  $institute_end_hour			= htmlspecialchars($_POST['post_institute_end_hour']);
  $institute_end_minute			= htmlspecialchars($_POST['post_institute_end_minute']);
  $institute_end_amorpm			= htmlspecialchars($_POST['post_institute_end_amorpm']);
  $recess_count					= htmlspecialchars($_POST['post_recess_count']);
  $first_recess_start_hour		= htmlspecialchars($_POST['post_first_recess_strat_hour']);
  $first_recess_start_minute	= htmlspecialchars($_POST['post_first_recess_strat_minute']);
  $first_recess_start_amorpm	= htmlspecialchars($_POST['post_first_recess_start_amorpms']);
  $first_recess_end_hour		= htmlspecialchars($_POST['post_first_recess_end_hour']);
  $first_recess_end_minute		= htmlspecialchars($_POST['post_first_recess_end_minute']);
  $first_recess_end_amorpm		= htmlspecialchars($_POST['post_first_recess_end_amorpms']);
  $second_recess_start_hour		= htmlspecialchars($_POST['post_second_recess_strat_hour']);
  $second_recess_start_minute	= htmlspecialchars($_POST['post_second_recess_strat_minute']);
  $second_recess_start_amorpm	= htmlspecialchars($_POST['post_second_recess_start_amorpms']);
  $second_recess_end_hour		= htmlspecialchars($_POST['post_second_recess_end_hour']);
  $second_recess_end_minute		= htmlspecialchars($_POST['post_first_recess_end_minute']);
  $second_recess_end_amorpm		= htmlspecialchars($_POST['post_second_recess_end_amorpms']);
  $daily_lecture_count			= htmlspecialchars($_POST['post_daily_lecture_count']);
  $lecture_gap_time				= htmlspecialchars($_POST['post_lecture_gap_time']);
  $holiday						= htmlspecialchars($_POST['post_holiday']);
  $closed_day					= htmlspecialchars($_POST['post_closed_day']);
  $halfday						= htmlspecialchars($_POST['post_halfday']);
  $opened_day					= htmlspecialchars($_POST['post_opened_day']);
  $halfday_lecture_count		= htmlspecialchars($_POST['post_halfday_lecture_count']);
  $srno=1;

 //calculating total number of lecture
 $five_days_lecture_count            = $daily_lecture_count * 5;
 $six_days_lecture_count             = $daily_lecture_count * 6;
 $fiveday_plus_halfday_lecture_count = $five_days_lecture_count + $halfday_lecture_count ;
 
 //allocating total number of lecture
 if(($holiday == 1)&($halfday == 1)){
	$total_lecture_count = $five_days_lecture_count;
 }
 else if(($holiday == 0)&($halfday == 1)){
	$total_lecture_count = $fiveday_plus_halfday_lecture_count;
 }
 else if(($holiday == 0)&($halfday == 0)){
	$total_lecture_count = $six_days_lecture_count;
 }
 

//inserting data in table  
function insert_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count,
	$total_lecture_count
)
{

  /* inserting data in user institute_time_detail  ,teacher_time_detail and class_time_detail table */
  $sql_statement1=$conn->prepare("
  INSERT INTO ".$table_name."
 (
	srno,
	col_institute_start_hour,
	col_institute_start_minute,
	col_institute_start_amorpm,
	col_institute_end_hour,
	col_institute_end_minute,
	col_institute_end_amorpm,
	col_recess_count,
	col_first_recess_start_hour,
	col_first_recess_start_minute,
	col_first_recess_start_amorpm,
	col_first_recess_end_hour,
	col_first_recess_end_minute,
	col_first_recess_end_amorpm,
	col_second_recess_start_hour,
	col_second_recess_start_minute,
	col_second_recess_start_amorpm,
	col_second_recess_end_hour,
	col_second_recess_end_minute,
	col_second_recess_end_amorpm,
	col_daily_lecture_count,
	col_holiday,
	col_closed_day,
	col_halfday,
	col_opened_day,
	col_halfday_lecture_count,
	col_total_lecture_count
 )VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
  
  $sql_statement1->bind_param("iiisiisiiisiisiisiissssssss",
    $srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$daily_lecture_count,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count,
	$total_lecture_count
  );
  $sql_statement1->execute();/* execution of query */
  
  if($lecture_gap_time!= "")
  {
  /* update data in user class_time_detail table for addional data */
  $sql_statement2=$conn->prepare("
  UPDATE ".$table_name." SET
	col_lecture_gap_time =	?
	WHERE srno           =  ?
 ");
  
  $sql_statement2->bind_param("ii",
	$lecture_gap_time,
	$srno
  );
  $sql_statement2->execute();/* execution of query */
 }
  
  if($student_count!= "")
  {
  /* update data in user class_time_detail table for addional data */
  $sql_statement2=$conn->prepare("
  UPDATE ".$table_name." SET
	col_student_count	=	?,
	col_batch_count		=	?
	WHERE srno          =   ?
 ");
  
  $sql_statement2->bind_param("iii",
	$student_count,
	$batch_count,
	$srno
  );
  $sql_statement2->execute();/* execution of query */
 }
 
}

//updateing data in table  
function update_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count,
	$total_lecture_count
)
{
	/* update data in user institute_time_detail  ,teacher_time_detail and class_time_detail table */
  $sql_statement3=$conn->prepare("
  UPDATE ".$table_name." SET
	col_institute_start_hour			=	?,
	col_institute_start_minute			=	?,
	col_institute_start_amorpm			=	?,
	col_institute_end_hour				=	?,
	col_institute_end_minute			=	?,
	col_institute_end_amorpm			=	?,
	col_recess_count					=	?,
	col_first_recess_start_hour			=	?,
	col_first_recess_start_minute		=	?,
	col_first_recess_start_amorpm		=	?,
	col_first_recess_end_hour			=	?,
	col_first_recess_end_minute			=	?,
	col_first_recess_end_amorpm			=	?,
	col_second_recess_start_hour		=	?,
	col_second_recess_start_minute		=	?,
	col_second_recess_start_amorpm		=	?,
	col_second_recess_end_hour			=	?,
	col_second_recess_end_minute		=	?,
	col_second_recess_end_amorpm		=	?,
	col_daily_lecture_count				=	?,
	col_holiday							=	?,
	col_closed_day						=	?,
	col_halfday							=	?,
	col_opened_day						=	?,
	col_halfday_lecture_count			=	?,
	col_total_lecture_count				=	?
	WHERE srno                          =   ?
 ");
  
  $sql_statement3->bind_param("iisiisiiisiisiisiissssssssi",
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$daily_lecture_count,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count,
	$total_lecture_count,
	$srno
  );
  $sql_statement3->execute();/* execution of query */
  
  if($lecture_gap_time!= "")
  {
  /* update data in user class_time_detail table for addional data */
  $sql_statement2=$conn->prepare("
  UPDATE ".$table_name." SET
	col_lecture_gap_time =	?
	WHERE srno           =  ?
 ");
  
  $sql_statement2->bind_param("ii",
	$lecture_gap_time,
	$srno
  );
  $sql_statement2->execute();/* execution of query */
 }
 
  if($student_count!= "")
  {
   /* update data in user class_time_detail table for additonal data */
  $sql_statement4=$conn->prepare("
  UPDATE ".$table_name." SET
	col_student_count	=	?,
	col_batch_count		=	?
	WHERE srno          =   ?
 ");
  
  $sql_statement4->bind_param("iii",
	$student_count,
	$batch_count,
	$srno
  );
  $sql_statement4->execute();/* execution of query */
 }
}

//insert institute time detail function
if(isset($_POST['insert_institute_time_detail']))
{   
	 /* create user institute_time_detail table  */
  $sql_query1="CREATE TABLE IF NOT EXISTS institute_time_detail
   ( /* Column name       Column data type */
		srno           	 				 	int NOT NULL, 
		col_institute_start_hour         	int,
		col_institute_start_minute       	int,
		col_institute_start_amorpm       	text,
		col_institute_end_hour        	 	int,
		col_institute_end_minute       	 	int,
		col_institute_end_amorpm       		text,
		col_recess_count       			 	int,
		col_first_recess_start_hour         int,
		col_first_recess_start_minute       int,
		col_first_recess_start_amorpm       text,
		col_first_recess_end_hour        	int,
		col_first_recess_end_minute       	int,
		col_first_recess_end_amorpm       	text,		
		col_second_recess_start_hour        int,
		col_second_recess_start_minute      int,
		col_second_recess_start_amorpm      text,
		col_second_recess_end_hour        	int,
		col_second_recess_end_minute       	int,
		col_second_recess_end_amorpm       	text,		
		col_daily_lecture_count       		text,
		col_holiday			        		text,				
		col_closed_day			       		text,	
		col_halfday       			       	text,		
		col_opened_day				  		text,	
        col_halfday_lecture_count       	text,
        col_total_lecture_count       		text,
		PRIMARY KEY (`srno`)
	);";
  $conn->query($sql_query1);/* execution of query */
 
 /* create user free_solt_detail table  */
  $sql_query1="CREATE TABLE IF NOT EXISTS free_solt_detail
   ( /* Column name      			 			 Column data type */
		srno       	 							 int AUTO_INCREMENT,
		col_teacher_name    					 text,
		col_lecture_place_name    				 text,
		col_first_lecture_count_0       		 int,
		col_first_lecture_temp_count_0       	 int,
		col_first_lecture_count_1       		 int,
		col_first_lecture_temp_count_1       	 int,
		col_first_lecture_count_2       		 int,
		col_first_lecture_temp_count_2       	 int,
		col_first_lecture_count_3       		 int,
		col_first_lecture_temp_count_3       	 int,
		col_first_lecture_count_4       		 int,
		col_first_lecture_temp_count_4       	 int,
		col_first_lecture_count_5       		 int,
		col_first_lecture_temp_count_5       	 int,
		col_recess_before_lecture_count_0   	 int,
		col_recess_before_lecture_temp_count_0   int,
		col_recess_before_lecture_count_1   	 int,
		col_recess_before_lecture_temp_count_1   int,
		col_recess_before_lecture_count_2  		 int,
		col_recess_before_lecture_temp_count_2   int,
		col_recess_before_lecture_count_3   	 int,
		col_recess_before_lecture_temp_count_3   int,
		col_recess_before_lecture_count_4   	 int,
		col_recess_before_lecture_temp_count_4   int,
		col_recess_before_lecture_count_5   	 int,
		col_recess_before_lecture_temp_count_5   int,
		col_recess_after_lecture_count_0    	 int,
		col_recess_after_lecture_temp_count_0    int,
		col_recess_after_lecture_count_1    	 int,
		col_recess_after_lecture_temp_count_1    int,
		col_recess_after_lecture_count_2    	 int,
		col_recess_after_lecture_temp_count_2    int,
		col_recess_after_lecture_count_3    	 int,
		col_recess_after_lecture_temp_count_3    int,
		col_recess_after_lecture_count_4    	 int,
		col_recess_after_lecture_temp_count_4    int,
		col_recess_after_lecture_count_5		 int,
		col_recess_after_lecture_temp_count_5	 int,
		col_total_lecture_count					 int,
		col_total_lecture_temp_count			 int,
		PRIMARY KEY (`srno`)
	);";
  $conn->query($sql_query1);/* execution of query */
  
  $table_name="institute_time_detail";
  insert_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count,
	$total_lecture_count
);
}

//insert teacher time detail function
if(isset($_POST['insert_teacher_time_detail']))
{
	$lecture_gap_time = htmlspecialchars($_POST['post_lecture_gap_time']);
	$teacher_name     = htmlspecialchars($_POST['post_teacher_name']);

/* create user teacher_time_detail table  */
  $sql_query2="CREATE TABLE IF NOT EXISTS ".$teacher_name."_time_detail
   ( /* Column name       Column data type */
		srno           	 				 	int NOT NULL,
		col_institute_start_hour         	int,
		col_institute_start_minute       	int,
		col_institute_start_amorpm       	text,
		col_institute_end_hour        	 	int,
		col_institute_end_minute       	 	int,
		col_institute_end_amorpm       		text,
		col_recess_count       			 	int,
		col_first_recess_start_hour         int,
		col_first_recess_start_minute       int,
		col_first_recess_start_amorpm       text,
		col_first_recess_end_hour        	int,
		col_first_recess_end_minute       	int,
		col_first_recess_end_amorpm       	text,		
		col_second_recess_start_hour        int,
		col_second_recess_start_minute      int,
		col_second_recess_start_amorpm      text,
		col_second_recess_end_hour        	int,
		col_second_recess_end_minute       	int,
		col_second_recess_end_amorpm       	text,
        col_daily_lecture_count       		text,
        col_lecture_gap_time	       		int,
		col_holiday			        		text,				
		col_closed_day			       		text,			
		col_halfday       			       	text,
		col_opened_day				  		text,
        col_halfday_lecture_count       	text,
        col_total_lecture_count       		text,
		PRIMARY KEY (`srno`)
	);";
  $conn->query($sql_query2);/* execution of query */
  
  $table_name=$teacher_name."_time_detail";
  
  insert_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count, 
	$total_lecture_count 
	);
}

//insert class time detail function
if(isset($_POST['insert_class_time_detail']))
{
	//storing data into local variable
	$lecture_gap_time	= htmlspecialchars($_POST['post_lecture_gap_time']);
	$student_count		= htmlspecialchars($_POST['post_student_count']);
	$batch_count		= htmlspecialchars($_POST['post_batch_count']);
    $class_name   		= htmlspecialchars($_POST['post_class_name']);

  /* create user class_time_detail table  */
  $sql_query3="CREATE TABLE IF NOT EXISTS ".$class_name."_time_detail
   ( /* Column name       Column data type */
		srno           	 				 	int NOT NULL,
		col_institute_start_hour         	int,
		col_institute_start_minute       	int,
		col_institute_start_amorpm       	text,
		col_institute_end_hour        	 	int,
		col_institute_end_minute       	 	int,
		col_institute_end_amorpm       		text,
		col_recess_count       			 	int,
		col_first_recess_start_hour         int,
		col_first_recess_start_minute       int,
		col_first_recess_start_amorpm       text,
		col_first_recess_end_hour        	int,
		col_first_recess_end_minute       	int,
		col_first_recess_end_amorpm       	text,		
		col_second_recess_start_hour        int,
		col_second_recess_start_minute      int,
		col_second_recess_start_amorpm      text,
		col_second_recess_end_hour        	int,
		col_second_recess_end_minute       	int,
		col_second_recess_end_amorpm       	text,
		col_student_count                	int,
		col_batch_count                  	int,
        col_daily_lecture_count       		text,
        col_lecture_gap_time	       		int,
		col_holiday			        		text,				
		col_closed_day			       		text,				
		col_halfday       			       	text,
		col_opened_day				  		text,
        col_halfday_lecture_count       	text,
        col_total_lecture_count		       	text,
		PRIMARY KEY (`srno`)
	);";
  $conn->query($sql_query3);/* execution of query */
  
  $table_name=$class_name."_time_detail";
  
  insert_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count, 
	$total_lecture_count 
	);
}  

//update institute time detail function
if(isset($_POST['update_institute_time_detail']))
{
	$table_name="institute_time_detail";
	
  update_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count,
	$total_lecture_count
);
}  

//update teacher detail function
if(isset($_POST['update_teacher_time_detail']))
{
	$lecture_gap_time = htmlspecialchars($_POST['post_lecture_gap_time']);
	$teacher_name     = htmlspecialchars($_POST['post_teacher_name']);
	
	$table_name=$teacher_name."_time_detail";
	
  update_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count, 
	$total_lecture_count 
	);
}
 
//update class time detail function
if(isset($_POST['update_class_time_detail']))
{
	//storing data into local variable
	$lecture_gap_time	= htmlspecialchars($_POST['post_lecture_gap_time']);
	$student_count		= htmlspecialchars($_POST['post_student_count']);
	$batch_count		= htmlspecialchars($_POST['post_batch_count']);
    $class_name   = htmlspecialchars($_POST['post_class_name']);

	$table_name=$class_name."_time_detail";
  update_data(
	$conn,
	$table_name,
	$srno,
	$institute_start_hour,
	$institute_start_minute,
	$institute_start_amorpm,
	$institute_end_hour,
	$institute_end_minute,
	$institute_end_amorpm,
	$recess_count,
	$first_recess_start_hour,
	$first_recess_start_minute,
	$first_recess_start_amorpm,
	$first_recess_end_hour,
	$first_recess_end_minute,
	$first_recess_end_amorpm,
	$second_recess_start_hour,
	$second_recess_start_minute,
	$second_recess_start_amorpm,
	$second_recess_end_hour,
	$second_recess_end_minute,
	$second_recess_end_amorpm,
	$student_count,
	$batch_count,
	$daily_lecture_count,
	$lecture_gap_time,
	$holiday,
	$closed_day,
	$halfday,
	$opened_day,
	$halfday_lecture_count, 
	$total_lecture_count 
	);
}  

//header("Location:index.php")
?>
